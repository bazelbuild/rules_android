---

x_defaults:
  tools: &tools
    name: "Tools"
    bazel: last_green
    build_targets:
    - "//src/..."
    - "-//src/java/com/example/sampleapp/..."
    - "//test/..."
    - "//android/..."
    - "//toolchains/..."
    - "//tools/..."
    - "-//tools/android/..." # TODO(#122): Un-exclude this once #122 is fixed.
    test_targets:
    - "//src/..."
    - "-//src/tools/enforce_min_sdk_floor/..."
    - "-//src/java/com/example/sampleapp/..."
    - "//test/..."
    - "-//test/rules/..."
    test_flags:
    # Sandboxed SDK tools depend on libraries that require Java runtime 17 or higher.
    - "--java_runtime_version=17"
  rules: &rules
    name: "Rules"
    bazel: last_green
    build_targets:
    - "//rules/..."
    test_targets:
    - "//test/rules/..."
    # TODO(https://github.com/bazelbuild/rules_android/issues/164):
    # Re-enable when android_local_test works properly with Android Platforms.
    - "-//test/rules/android_local_test/..."
    build_flags:
    - "--incompatible_enable_android_toolchain_resolution"
    - "--android_platforms=//:arm64-v8a"
    - "--platforms=//:arm64-v8a"

tasks:
  ubuntu2004_tools:
    platform: ubuntu2004
    <<: *tools
  ubuntu2004_rules:
    platform: ubuntu2004
    <<: *rules
  macos_tools:
    platform: macos
    <<: *tools
  macos_rules:
    platform: macos
    <<: *rules
  macos_arm64_tools:
    platform: macos_arm64
    <<: *tools
  macos_arm64_rules:
    platform: macos_arm64
    <<: *rules
  ubuntu2004_bzlmod_tools:
    name: Tools bzlmod
    platform: ubuntu2004
    build_flags:
    - "--enable_bzlmod"
    <<: *tools
  ubuntu2004_bzlmod_rules:
    name: Rules bzlmod
    platform: ubuntu2004
    build_flags:
    - "--enable_bzlmod"
    <<: *rules
  macos_bzlmods_tools:
    name: Tools bzlmod
    platform: macos
    build_flags:
    - "--enable_bzlmod"
    <<: *tools
  macos_bzlmods_rules:
    name: Rules bzlmod
    platform: macos
    build_flags:
    - "--enable_bzlmod"
    <<: *rules
  macos_arm64_bzlmod_tools:
    name: Rules bzlmod
    platform: macos_arm64
    build_flags:
    - "--enable_bzlmod"
    <<: *tools
  macos_arm64_bzlmod_rules:
    name: Rules bzlmod
    platform: macos_arm64
    build_flags:
    - "--enable_bzlmod"
    <<: *rules
